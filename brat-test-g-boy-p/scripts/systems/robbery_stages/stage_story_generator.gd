# stage_story_generator.gd - Генератор художественных текстов для этапов ограбления
extends Node

# Генерация художественного описания для этапа проникновения
static func generate_entry_story(method: String, is_success: bool, stat_used: String) -> String:
	var stories = {
		"lockpick_success": [
			"Отмычка скользит в замочную скважину, штифты один за другим поддаются. Щелчок — и дверь открыта. Профессионально.",
			"Руки действуют на автомате. Тихий скрежет металла, легкий поворот... Готово. Внутри никого не слышно.",
			"Замок старый, простой. Пара движений — и механизм поддается. Заходите, не стесняйтесь."
		],
		"lockpick_fail": [
			"Отмычка ломается с противным хрустом. Замок не поддался. Придется искать другой способ.",
			"Штифты не желают вставать на место. Сколько ни пытаешься — толку ноль. Может, руки дрожат?",
			"Замок оказался хитрее, чем казалось. Отмычка соскальзывает, царапая металл. Не судьба."
		],
		"window_success": [
			"Удар ножом по краю рамы — стекло трескается. Еще один — и окно поддается. Тихо убираешь осколки и проскальзываешь внутрь.",
			"Ломом поддеваешь раму. Древесина трещит, но не громко. Окно открывается с глухим скрипом. Внутри.",
			"Бита врезается в стекло — оно разлетается на мелкие куски. Быстро смахиваешь осколки и пролезаешь внутрь."
		],
		"window_fail": [
			"Удар вышел слишком громким. Где-то залаяла собака. Соседи зашевелились. Лучше свалить отсюда.",
			"Рама крепче, чем казалась. Попытка выбить окно привлекла внимание. Кто-то смотрит в твою сторону...",
			"Стекло не разбилось с первого раза. Шум поднялся нехилый. Прохожий уже тянется за телефоном."
		],
		"talk_success": [
			"Пара слов, правильная интонация — и охранник отворачивается. 'Да ладно, проходи'. Слишком легко.",
			"Улыбка, дружеский тон, пара купюр в ладони... Охранник кивает и открывает дверь. Бизнес есть бизнес.",
			"Болтовня о погоде, жалобы на жизнь. Охранник расслабляется, пропускает внутрь. Классика жанра."
		],
		"talk_fail": [
			"Охранник смотрит подозрительно. 'Тебе чего здесь надо?' Разговор не клеится. Придется валить.",
			"Слова не убеждают. Охранник хмурится, рука тянется к рации. Времени нет — нужен другой план.",
			"Неловкая пауза. Охранник чувствует подвох. 'Проваливай отсюда'. Не прокатило."
		]
	}

	var key = method + ("_success" if is_success else "_fail")
	if stories.has(key):
		var story_list = stories[key]
		return story_list[randi() % story_list.size()]

	return "Что-то пошло не так..." if not is_success else "Всё прошло гладко."

# Генерация художественного описания для этапа действия (сбор добычи)
static func generate_action_story(loot_amount: String, building_type: String) -> String:
	var stories = {
		"quick_ЛАРЁК": [
			"Хватаешь с полки пачки сигарет, бутылки — что попалось. Быстро в сумку и на выход.",
			"Кассовый ящик пуст, но на витрине лежит что-то ценное. Сгребаешь всё подряд и сваливаешь."
		],
		"quick_КВАРТИРА": [
			"Шкаф, тумбочка — наскоро проверяешь самые очевидные места. Пара украшений в карман и бегом.",
			"Быстрый обыск комнаты. Телефон, часы — всё что на виду. Время не ждет."
		],
		"medium_ЛАРЁК": [
			"Проверяешь кассу, полки, подсобку. Находишь заначку за батареей. Неплохой улов.",
			"Методично обшариваешь помещение. Сигареты, алкоголь, немного налички. Сойдет."
		],
		"medium_КВАРТИРА": [
			"Осматриваешь квартиру внимательно. Ювелирка в шкафу, деньги под матрасом. Хозяева не слишком хитрые.",
			"Обыск занимает время, но результат того стоит. Техника, украшения, пара купюр. Всё в сумку."
		],
		"greedy_ЛАРЁК": [
			"Выносишь всё что можно унести. Ящики с сигаретами, дорогой алкоголь, даже кассовый аппарат попытался забрать. Жадность фраера сгубила?",
			"Грузишь товар, не жалея времени. Каждая минута на счету, но добыча того стоит. Сумки ломятся от барахла."
		],
		"greedy_КВАРТИРА": [
			"Обшариваешь каждый угол. Техника, ювелирка, даже посуда — всё идет в дело. Тащишь мешки до отказа.",
			"Жадность берет верх. Роешься везде — под полом, за обоями. Нашел сейф! Но времени уходит много..."
		]
	}

	var key = loot_amount + "_" + building_type
	if stories.has(key):
		var story_list = stories[key]
		return story_list[randi() % story_list.size()]

	# Универсальные варианты
	match loot_amount:
		"quick":
			return "Быстро хватаешь самое ценное и готовишься к отходу."
		"medium":
			return "Собираешь добычу методично, не торопясь слишком сильно."
		"greedy":
			return "Жадность берет верх — тащишь всё что не прибито. Времени уходит много."

	return "Собираешь добычу."

# Генерация художественного описания для этапа побега
static func generate_escape_story(method: String, is_caught: bool) -> String:
	var stories = {
		"sneak_success": [
			"Тихо прикрываешь дверь за собой. Никто не заметил. Спокойным шагом уходишь в ночь.",
			"Незаметно выскальзываешь наружу. Прохожие идут мимо, не обращая внимания. Чисто сработано.",
			"Крадешься в тени домов, избегая фонарей. Патруль проезжает мимо — не видят. Профессионально."
		],
		"sneak_caught": [
			"Пытаешься уйти тихо, но патруль сворачивает за угол прямо на тебя. Облом...",
			"Крадешься к выходу, но споткнулся о мусорный бак. Грохот — и все обернулись. Провалился."
		],
		"run_success": [
			"Рванул со всех ног! Аллеи, дворы, заборы — всё летит мимо. Оторвался!",
			"Бежишь не оглядываясь. Сердце колотится, но ноги несут. Патруль далеко позади.",
			"Спринт через весь район. Люди шарахаются в стороны, но ты уже далеко. Свободен!"
		],
		"run_caught": [
			"Бежишь изо всех сил, но патруль оказался быстрее. Машина подрезает путь. Конец игры.",
			"Пытаешься убежать, но споткнулся. Когда поднялся — менты уже рядом. Не повезло."
		],
		"car_success": [
			"Запрыгиваешь в тачку, газ в пол! Мотор ревет, шины визжат. Свобода!",
			"Машина срывается с места. Ветер в окна, город мелькает за стеклом. Угнали и смылись!",
			"Рулишь как безумный, петляешь по улицам. Патруль отстал. Ха! Не догонят."
		],
		"car_caught": [
			"Газ в пол, но патруль не отстает. Перекрыли дорогу, пришлось тормозить. Поймали.",
			"Пытаешься уехать, но машина глохнет. Менты уже окружают. Провал."
		]
	}

	var key = method + ("_success" if not is_caught else "_caught")
	if stories.has(key):
		var story_list = stories[key]
		return story_list[randi() % story_list.size()]

	return "Отход прошел..." + (" гладко." if not is_caught else " не по плану.")
